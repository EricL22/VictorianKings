namespace = ideology

# Playable characters choose an ideology
ideology.1 = {
	type = character_event
	title = ideology.1.name
	desc = ideology.1.desc
	theme = diplomacy
	left_portrait = {
		character = root
		animation = idle
	}

	immediate = {
		hidden_effect = {
			remove_character_flag = liberal_party
			remove_character_flag = socialist_party
			remove_character_flag = reactionary_party
			remove_character_flag = fascist_party
			remove_character_flag = conservative_party
			remove_character_flag = communist_party
			remove_character_flag = anarchist_party
			remove_character_modifier = liberal_party_modifier
			remove_character_modifier = socialist_party_modifier
			remove_character_modifier = reactionary_party_modifier
			remove_character_modifier = fascist_party_modifier
			remove_character_modifier = conservative_party_modifier
			remove_character_modifier = communist_party_modifier
			remove_character_modifier = anarchist_party_modifier
		}
	}
	
	option = {
		name = ideology.1.a
		add_character_flag = liberal_party
		add_character_modifier = liberal_party_modifier
		ai_chance = {
			base = 1
			modifier = {
				factor = 2
				has_trait = just
			}
			modifier = {
				add = 1
				current_date > 1960.1.1
			}
		}
	}
	option = {
		name = ideology.1.b
		add_character_flag = socialist_party
		add_character_modifier = socialist_party_modifier
		ai_chance = {
			base = 1
			modifier = {
				factor = 2
				has_trait = impatient
				has_trait = cynical
			}
			modifier = {
				factor = 0
				OR = {
					has_trait = zealous
					has_trait = arrogant
				}
			}
			modifier = {
				factor = 0
				current_date < 1848.1.1
			}
		}
	}
	option = {
		name = ideology.1.c
		add_character_flag = reactionary_party
		add_character_modifier = reactionary_party_modifier
		ai_chance = {
			base = 1
			modifier = {
				factor = 2
				OR = {
					has_trait = ambitious
					has_trait = zealous
				}
			}
			modifier = {
				factor = 0
				has_trait = cynical
			}
			modifier = {
				factor = 2
				NOT = { has_realm_law = city_succession_law }
				ai_boldness > 60
				ai_energy > 0
			}
			modifier = {
				factor = 0
				top_liege = { has_title = title:e_united_states }
			}
		}
	}
	option = {
		name = ideology.1.d
		add_character_flag = fascist_party
		add_character_modifier = fascist_party_modifier
		ai_chance = {
			base = 1
			modifier = {
				factor = 2
				has_trait = arbitrary
				OR = {
					has_trait = callous
					has_trait = sadistic
				}
			}
			modifier = {
				factor = 0
				has_trait = compassionate
			}
			modifier = {
				factor = 0
				current_date < 1900.1.1
			}
		}
	}
	option = {
		name = ideology.1.e
		add_character_flag = conservative_party
		add_character_modifier = conservative_party_modifier
		ai_chance = {
			base = 1
			modifier = {
				factor = 3
				has_trait = content
			}
			modifier = {
				add = 1
				current_date < 1960.1.1
			}
			modifier = {
				add = 2
				NOT = { has_realm_law = city_succession_law }
			}
		}
	}
	option = {
		name = ideology.1.f
		add_character_flag = communist_party
		add_character_modifier = communist_party_modifier
		ai_chance = {
			base = 1
			modifier = {
				factor = 2
				has_trait = arbitrary
				has_trait = cynical
			}
			modifier = {
				factor = 0
				OR = {
					has_trait = zealous
					has_trait = arrogant
				}
			}
			modifier = {
				factor = 0
				current_date < 1848.1.1
			}
		}
	}
	option = {
		name = ideology.1.g
		add_character_flag = anarchist_party
		add_character_modifier = anarchist_party_modifier
		ai_chance = {
			base = 0
			modifier = {
				add = 2
				has_trait = lazy
			}
			modifier = {
				factor = 0
				has_trait = ambitious
			}
			modifier = {
				factor = 0
				current_date < 1860.1.1
			}
		}
	}
}

# Character is kicked out of party
ideology.2 = {
	type = character_event
	title = ideology.2.name
	desc = ideology.2.desc
	theme = diplomacy
	left_portrait = {
		character = root
		animation = disbelief
	}

	immediate = {
		add_character_modifier = independent_party_modifier
	}
	
	option = {
		name = ideology.2.a
	}
}

# Updates the ideological leaning of counties, repeats every month
ideology.3 = {
	type = empty
	hidden = yes

	immediate = {
		if = {
			limit = { NOT = { has_global_variable = ideology_pulse_started } }
			set_global_variable = {
				name = ideology_pulse_started
				value = yes
			}
		}
		# Iterate through all counties in the game
		every_county = {
			limit = { holder = { root_realm_uses_legislature_trigger = yes } }
			save_temporary_scope_value_as = { name = modifier_value value = county_liberal_modifier }
			if = {
				limit = { has_variable = liberal_value }
				change_variable = {
					name = liberal_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:liberal_value <= 0 }
					remove_variable = liberal_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = liberal_value
					value = scope:modifier_value
				}
			}
			
			save_temporary_scope_value_as = { name = modifier_value value = county_socialist_modifier }
			if = {
				limit = { has_variable = socialist_value }
				change_variable = {
					name = socialist_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:socialist_value <= 0 }
					remove_variable = socialist_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = socialist_value
					value = scope:modifier_value
				}
			}
			
			save_temporary_scope_value_as = { name = modifier_value value = county_reactionary_modifier }
			if = {
				limit = { has_variable = reactionary_value }
				change_variable = {
					name = reactionary_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:reactionary_value <= 0 }
					remove_variable = reactionary_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = reactionary_value
					value = scope:modifier_value
				}
			}
			
			save_temporary_scope_value_as = { name = modifier_value value = county_fascist_modifier }
			if = {
				limit = { has_variable = fascist_value }
				change_variable = {
					name = fascist_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:fascist_value <= 0 }
					remove_variable = fascist_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = fascist_value
					value = scope:modifier_value
				}
			}
			
			save_temporary_scope_value_as = { name = modifier_value value = county_conservative_modifier }
			if = {
				limit = { has_variable = conservative_value }
				change_variable = {
					name = conservative_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:conservative_value <= 0 }
					remove_variable = conservative_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = conservative_value
					value = scope:modifier_value
				}
			}
			
			save_temporary_scope_value_as = { name = modifier_value value = county_communist_modifier }
			if = {
				limit = { has_variable = communist_value }
				change_variable = {
					name = communist_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:communist_value <= 0 }
					remove_variable = communist_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = communist_value
					value = scope:modifier_value
				}
			}
			
			save_temporary_scope_value_as = { name = modifier_value value = county_anarchist_modifier }
			if = {
				limit = { has_variable = anarchist_value }
				change_variable = {
					name = anarchist_value
					add = scope:modifier_value
				}
				if = {
					limit = { var:anarchist_value <= 0 }
					remove_variable = anarchist_value
				}
			}
			else_if = {
				limit = { scope:modifier_value > 0 }
				set_variable = {
					name = anarchist_value
					value = scope:modifier_value
				}
			}
		}
		trigger_event = { id = ideology.3 months = 1 }
	}
}
